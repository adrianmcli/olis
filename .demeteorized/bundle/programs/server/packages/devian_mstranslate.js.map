{"version":3,"sources":["meteor://ðŸ’»app/packages/devian_mstranslate/packages/devian_mstranslate.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"/packages/devian_mstranslate.js","sourcesContent":["(function () {\n\n///////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                       //\n// packages/devian:mstranslate/authentication.js                                         //\n//                                                                                       //\n///////////////////////////////////////////////////////////////////////////////////////////\n                                                                                         //\nvar accessToken                                                                          // 1\nvar getAccessToken = requestNewAccesToken                                                // 2\n                                                                                         // 3\nfunction requestNewAccesToken() {                                                        // 4\n\t// request a new acces token from Microsoft                                             // 5\n\tvar response = HTTP.post('https://datamarket.accesscontrol.windows.net/v2/OAuth2-13', { // 6\n\t\tparams: {                                                                              // 7\n\t\t\t// TODO replace with meteor.settings                                                  // 8\n\t\t\tclient_id: Meteor.settings.msTranslator.id,                                           // 9\n\t\t\tclient_secret: Meteor.settings.msTranslator.secret,                                   // 10\n\t\t\tscope: \"http://api.microsofttranslator.com\",                                          // 11\n\t\t\tgrant_type: 'client_credentials'                                                      // 12\n\t\t}                                                                                      // 13\n\t})                                                                                      // 14\n                                                                                         // 15\n\t// Parse the JSON response                                                              // 16\n\tvar responseBody = EJSON.parse(response.content)                                        // 17\n                                                                                         // 18\n\t// retreive the actual token from the response                                          // 19\n\taccessToken = EJSON.parse(response.content).access_token                                // 20\n                                                                                         // 21\n\t// switch the getAccessToken function to requestNewAccesToken when the token expires    // 22\n\tMeteor.setTimeout(function() {                                                          // 23\n\t\tgetAccessToken = requestNewAccesToken                                                  // 24\n\t}, responseBody.expires_in * 1000)                                                      // 25\n                                                                                         // 26\n\t// switch the getAccessToken function to cached version for now                         // 27\n\tgetAccessToken = getCachedAccessToken                                                   // 28\n                                                                                         // 29\n\treturn accessToken                                                                      // 30\n}                                                                                        // 31\n                                                                                         // 32\nfunction getCachedAccessToken() {                                                        // 33\n\treturn accessToken                                                                      // 34\n}                                                                                        // 35\n                                                                                         // 36\ngetAuthorizationHeader = function() {                                                    // 37\n\treturn {                                                                                // 38\n\t\tAuthorization: \"Bearer\" + \" \" + getAccessToken()                                       // 39\n\t}                                                                                       // 40\n}                                                                                        // 41\n///////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n\n\n\n\n(function () {\n\n///////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                       //\n// packages/devian:mstranslate/mstranslate.js                                            //\n//                                                                                       //\n///////////////////////////////////////////////////////////////////////////////////////////\n                                                                                         //\nMicrosoft = {                                                                            // 1\n\ttranslate: translate,                                                                   // 2\n\tdetect: detect                                                                          // 3\n}                                                                                        // 4\n                                                                                         // 5\nfunction request(path, params) {                                                         // 6\n\tvar response = HTTP.get('http://api.microsofttranslator.com/V2/Http.svc/' + path, {     // 7\n\t\tparams: _.extend({ appId: ''}, params),                                                // 8\n\t\theaders: getAuthorizationHeader()                                                      // 9\n\t})                                                                                      // 10\n                                                                                         // 11\n\treturn xml2js.parseStringSync(response.content).string['_']                             // 12\n}                                                                                        // 13\n                                                                                         // 14\nfunction translate(text, language) {                                                     // 15\n\treturn request('Translate', {                                                           // 16\n\t\ttext: text,                                                                            // 17\n\t\tto: language,                                                                          // 18\n\t\tcontentType: 'text/plain'                                                              // 19\n\t})                                                                                      // 20\n}                                                                                        // 21\n                                                                                         // 22\nfunction detect(text) {                                                                  // 23\n\treturn request('Detect', { text: text })                                                // 24\n}                                                                                        // 25\n///////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n"]}